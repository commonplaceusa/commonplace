- if Rails.env.production?
  %script
    = "mpmetrics.track('Community Registration Page', {'community': '#{current_community.slug}'});"

%script
  $(function(){$('input[placeholder], textarea[placeholder]').placeholder();});

:javascript
  function facebookUserLoggedIn()
  {
    if (CommonPlace.env == "production")
      mpmetrics.track('Attempted Facebook Connect', {'community': '#{current_community.slug}'});
    session = FB.getSession()
    if (!session.uid || session.uid == '')
      alert("We could not log you into Facebook. Please try again.");
    else
    {
      FB.api('/me', function(response) {
        if (CommonPlace.env == "production")
        {
          mpmetrics.identify(response.email);
          mpmetrics.track('Connected with Facebook', {'community': '#{current_community.slug}'});
        }
        $("#user_full_name").val(response.name);
        $("#user_email")
          .attr("readonly", "true")
          .val(response.email);
        $("<input />").attr("type","hidden")
          .attr("id", "user_facebook_uid")
          .attr("name", "user[facebook_uid]")
          .val(response.id)
          .appendTo("#new_user");
        /*$("<input />").attr("type","hidden")
          .attr("id", "user_facebook_session")
          .attr("name", "user[facebook_session]")
          .val(JSON.stringify(session))
          .appendTo("#new_user");*/
        $("#user_address").focus();
      });
    }
  }
  $(document).ready(function() {
    FB.Event.subscribe('auth.login', function(response) {
      if (response.session)
      {
        $("<input />").attr("type","hidden")
          .attr("id", "user_facebook_session")
          .attr("name", "user[facebook_session]")
          .val(JSON.stringify(response.session))
          .appendTo("#new_user");
      }
    })
  })
  
#wrapper
  #titleslug
    %h1= t(".h1", :community => current_community.name).html_safe
  #registration_information
    %ul{:id=>"infolist"}
      %li= t(".li1", :community => current_community.name)
      %li= t(".li2", :community => current_community.name)
      %li= t(".li3", :community => current_community.name)
    %ul{:id=>"link_item"}
      %h3=t(".project", :learn_more => link_to(t(".learn_more"), "/#{current_community.slug}/learn_more")).html_safe
  #main
    = semantic_form_for @user, :url => create_account_path(current_community) do |f|
      %table{:style => "width:360px;"}
        %tr
          %td{:style => "text-align:left;"}  
            %h4 
              Register Here
          %td{:style => "text-align:right;"}  
            %h3 
              or
              %fb:login-button{:size => 'medium', :length => 'long', :onlogin => 'facebookUserLoggedIn();', :perms => 'email,user_hometown,publish_stream,offline_access'}
      = f.inputs do
        = f.input :full_name, :input_html => { :placeholder => "Full name"} 
        = f.input :email, :input_html => { :placeholder => "Email address"}
        = f.input :address, :hint => "", :input_html => {:placeholder => "Address"}
      #fb-wrapper
        = f.buttons do 
          = f.commit_button :button_html => {:type => "image", :src => "/images/buttons/signup.png"}

#fb-root
- if current_community.organizer_about?
  /
    #who_is_info_bubble
      %h3.toggle= t ".who_is_bubble", :community=> current_community.name
      #who_is_info
        %p
          = current_community.organizer_about
        =image_tag(current_community.organizer_avatar.url, :size => "50x50")
        %br{:class => "cleared"}   

        %h3 Which local organizations are on #{current_community.name}'s CommonPlace?
        - current_community.feeds.take(20).each do |feed|
          %p
            = feed.name
          = image_tag(feed.avatar_url(:thumb), :size => "50x50")
          %br{:class => "cleared"}
