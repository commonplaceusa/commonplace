(function(a){a.polygonInputs=function(){a("textarea.polygon").each(function(){var f=a(this),g=a("<div class='polygon-canvas'></div>"),i=a("<input type='text' placeholder='Address' class='polygon-location'>"),j=a("<button class='polygon-go'>Go</button>"),c=a("<button class='polygon-clear'>Clear</button>"),e=new google.maps.Geocoder();f.before(i);f.before(j);f.before(c);f.before(g);var b=new google.maps.Map(g.get(0),{zoom:15,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,nagivationControl:true,mapTypeControl:false,scaleControl:true}),h=new google.maps.Polygon({clickable:false,paths:[[]],strokeColor:"#FF0000",strokeOpacity:0.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0.35,map:b});function d(){f.val("["+a.map(h.getPath().getArray(),function(k){return"["+k.lat()+", "+k.lng()+"]"}).join(", ")+"]")}d();google.maps.event.addListener(b,"click",function(k){h.getPath().push(k.latLng);d()});j.click(function(k){k.preventDefault();e.geocode({address:i.val()},function(m,l){b.panTo(m[0].geometry.location)})});c.click(function(k){k.preventDefault();h.setPath([]);d()})})}})(jQuery);function renderMaps(){if(window.google){$("div[data-map]").each(function(){var c=$(this);var a=$.parseJSON(c.attr("data-map"));if(a&&a.center){var b=new google.maps.Geocoder();b.geocode({address:a.center},function(d){var e=new google.maps.Map(c.get(0),{zoom:15,center:d[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP,navigationControl:true,mapTypeControl:false,scaleControl:true});c.data("map",e);$.each(a.markers,function(){renderMarker(this,e,b)});$.each(a.polygons,function(){renderPolygon(this,e)});$.each(a.directions,function(){renderDirections(this,e)})})}})}}function renderMarker(a,c,b){b.geocode({address:a.position},function(d){new google.maps.Marker({position:d[0].geometry.location,map:c})})}function jsonToLatLng(a){return new google.maps.LatLng(a.lat,a.lng)}function renderPolygon(a,d){var c=$.map(a.vertices,jsonToLatLng),b=new google.maps.Polygon({paths:c,strokeColor:"#0000FF",strokeOpacity:0.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:0.35});b.setMap(d)}function renderDirections(b,e){if(!b.origin){return}var d=new google.maps.DirectionsService(),c=new google.maps.DirectionsRenderer({suppressMarkers:true}),a={origin:b.origin,destination:b.destination,travelMode:google.maps.DirectionsTravelMode.WALKING};c.setMap(e);d.route(a,function(f,g){if(g==google.maps.DirectionsStatus.OK){c.setDirections(f)}})}$(function(){renderMaps();$.polygonInputs()});