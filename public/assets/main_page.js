((function(){CommonPlace.main.BaseForm=CommonPlace.View.extend({tagName:"form",className:"create-neighborhood-post post",category:"neighborhood",events:{"click .submit":"createPost","focusin input, textarea":"onFormFocus","keydown textarea":"resetLayout","focusout input, textarea":"onFormBlur","click .back":"showPostbox","click .delete":"deletePost","click .transaction":"openTransactionForm","click #new_feed_button":"createFeed"},initialize:function(a){if(a){a.template&&(this.template=a.template||this.template),a.category&&(this.category=a.category||this.category),a.model?this.model=a.model:this.model=void 0;if(a.modal)return this.modal=a.modal}},afterRender:function(){return this.$("input[placeholder], textarea[placeholder]").placeholder(),this.hideSpinner(),this.populateFormData()},populateFormData:function(){var a,b,c;if(this.isPostEdit())return b=this.model.get("group_id"),a=this.model.get("feed_id"),this.model.get("title")&&this.$("[name=title]").val(this.model.get("title")),this.model.get("body")&&this.$("[name=body]").val(this.model.get("body")),b&&(this.$('"[value='+b+']"').attr("selected","selected"),this.$("[name='group_selector']").attr("disabled","disabled")),a&&(this.$('"[value='+a+']"').attr("selected","selected"),this.$("[name='feed_selector']").attr("disabled","disabled")),this.model.get("date")&&this.$("[name=date]").val(this.model.get("date").split("T")[0]),this.model.get("venue")&&this.$("[name=venue]").val(this.model.get("venue")),this.model.get("address")&&this.$("[name=address]").val(this.model.get("address")),this.model.get("starts_at")&&this.$(".starting_times[value='"+this.model.get("starts_at").trim()+"']").attr("selected","selected"),this.model.get("ends_at")&&this.$(".ending_times[value='"+this.model.get("ends_at").trim()+"']").attr("selected","selected"),this.model.get("price")&&this.$("[name=price]").val(this.model.get("price")/100),c=this.model.get("images"),c&&c[0]&&this.$(".item_pic").attr("src",c[0].image_url),this.$(".chzn-select").trigger("liszt:updated")},isPostEdit:function(){return this.model?!0:!1},deletePost:function(){if(this.isPostEdit())return this.model.destroy(),this.exit()},showSpinner:function(){return this.$(".spinner").show()},hideSpinner:function(){return this.$(".spinner").hide()},enableSubmitButton:function(){return this.$(".submit").removeAttr("disabled")},disableSubmitButton:function(){return this.$(".submit").attr("disabled","disabled")},createFeed:function(a){return a&&a.preventDefault(),this.showFeedCreationForm(),this.exit()},createPost:function(a){var b;return a.preventDefault(),this.cleanUpPlaceholders(),this.showSpinner(),this.disableSubmitButton(),this.options.category===undefined?(this.showError("Please select a category"),this.hideSpinner(),this.enableSubmitButton()):(b={title:this.$("[name=title]").val(),body:this.$("[name=body]").val(),category:this.$("[name=categorize]").val()},this.sendPost(CommonPlace.community.posts,b))},sendPost:function(a,b,c){var d,e,f;e=this;if(this.isPostEdit()){for(d in b)f=b[d],this.model.set(d,f);return this.model.save(),this.exit()}return a.create(b,{success:_.bind(function(b){a.trigger("sync"),e.render(),e.resetLayout(),typeof _kmq!="undefined"&&_kmq!==null&&_kmq.push(["record","Post",{Schema:b.get("schema"),ID:b.id}]),this.showShareModal(b,"Thanks for posting!","You've just shared this post with "+this.getUserCount()+" neighbors in "+this.community_name()+". Share with some more people!");if(c)return c()},this),error:function(a,b){return typeof _kmq!="undefined"&&_kmq!==null&&_kmq.push(["record","Post Error",{Attributes:a}]),e.hideSpinner(),e.enableSubmitButton(),e.showError(b.responseText)}})},exit:function(){if(this.modal)return this.modal.exit()},getUserCount:function(){return CommonPlace.community.get("user_count")},showShareModal:function(a,b,c){var d;return d=new CommonPlace.views.ShareModal({model:a}),d.set_header(b),d.set_message(c),d.render()},showPostbox:function(a){var b;return a&&a.preventDefault(),b=new CommonPlace.main.PostBox({account:CommonPlace.account,community:CommonPlace.community}),b.render()},showError:function(a){return this.$(".error").text(a),this.$(".error").show()},onFormFocus:function(){var a,b;a=this.$(".on-focus");if(!a.is(":visible"))return b=a.actual("height"),a.css({height:0}),a.show(),CommonPlace.layout.reset()},onFormBlur:function(a){return $("#invalid_post_tooltip").hide(),this.focused||(this.$(".on-focus").hide(),this.resetLayout()),!$(a.target).val()||$(a.target).val()===$(a.target).attr("placeholder")?$(a.target).removeClass("filled"):$(a.target).addClass("filled")},resetLayout:function(){return CommonPlace.layout.reset()},hideLabel:function(a){return $("option.label",a.target).hide()},openTransactionForm:function(a){var b;return a.preventDefault(),b=new CommonPlace.main.PostBox({account:CommonPlace.account,community:CommonPlace.community}),b.render(),b.showTab("transaction")}})})).call(this);var AccountProfile=CommonPlace.View.extend({template:"main_page.account-profile",className:"profile",events:{"click ul.history a":"showHistoricalItem"},comma:function(a){return" "+a},afterRender:function(){var a=this;this.model.profileHistory(function(b){var c=new ProfileHistory({collection:b,el:a.$(".profile-history"),model:a.model});c.render()})},avatarUrl:function(){return this.model.get("avatar_url")},fullName:function(){return this.model.get("name")},shortName:function(){return this.model.get("short_name")},about:function(){return this.model.get("about")},interests:function(){return _.map(this.model.get("interests"),this.comma)},skills:function(){return _.map(this.model.get("skills"),this.comma)},goods:function(){return _.map(this.model.get("goods"),this.comma)},subscriptions:function(){return this.model.get("subscriptions")},groups:function(){return""},hasInterests:function(){return this.model.get("interests").length>0},hasSkills:function(){return this.model.get("skills").length>0},hasGoods:function(){return this.model.get("goods").length>0},hasAbout:function(){return this.model.get("about")!==undefined},post_count:function(){return this.model.get("post_count")},reply_count:function(){return this.model.get("reply_count")},editUrl:function(){return"/"+CommonPlace.community.get("slug")+"/account"},showHistoricalItem:function(){this.options.highlightSingleUser(this.model)}});((function(){CommonPlace.main.CommunityResources=CommonPlace.View.extend({template:"main_page.community-resources",id:"community-resources",events:{"submit .sticky form":"search","keyup .sticky input":"debounceSearch","click .sticky .cancel":"cancelSearch"},initialize:function(){return _.bindAll(this,"debounceSearch"),this.eventAggregator.bind("searchBox:submit",this.debounceSearch)},afterRender:function(){var a;return a=this,this.isGuest()&&$("body").addClass("public"),this.searchForm=new this.SearchForm,this.searchForm.render(),$(this.searchForm.el).prependTo(this.$(".sticky")),$("#main").height($(document).height())},changeSearchText:function(a){var b,c;return b=$("#search-header"),this.cancelSearch(),c="Search "+CommonPlace.community.get("name").trim()+"...",a&&(c="Search "+a.trim()+"...",b.attr("placeholder","Search "+a.trim()+"...")),b.attr("placeholder",c),this.browserSupportsPlaceholders()?b.attr("value",""):b.attr("value",c)},switchTab:function(a,b){var c,d;d=this,this.view=this.tabs[a](this),$(".wire_filter").removeClass("current"),$("#"+a).addClass("current"),c=$("#"+a).text(),this.changeSearchText(c),this.$(".search-switch").removeClass("active"),_.include(["users","groups","feeds"],a)?this.$(".directory-search").addClass("active"):this.$(".post-search").addClass("active"),b&&this.view.singleWire(b);if(d.currentQuery)return d.search();d.showTab();if(typeof _kmq!="undefined"&&_kmq!==null)return _kmq.push(["record","Wire Engagement",{Type:"Tab",Tab:a}])},winnowToCollection:function(a){var b;return b=this,this.view=this.tabs[a](this),this.$(".search-switch").removeClass("active"),_.include([],a)&&this.$(".post-search").addClass("active"),b.currentQuery?b.search():b.showTab()},showTab:function(){var a;return a=this.$(".resources"),a.css("filter","alpha(opacity=20)"),a.fadeOut(500,_.bind(function(){var b;return a.html(this.loading()),b=this,this.view.resources(function(b){return b.render(),a=this.$(".resources"),a.html(b.el),a.css("filter","alpha(opacity=20)"),$(".resources").fadeIn(900)})},this))},tabs:{all_posts:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.postlikes}),a.makeTab(b)},posts:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.posts,isInAllWire:!1}),a.makeTab(b)},neighborhood:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.categories.neighborhood}),a.makeTab(b)},help:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.categories.help}),a.makeTab(b)},questions:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.categories.offers}),a.makeTab(b)},publicity:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.categories.publicity}),a.makeTab(b)},other:function(a){var b;return b=new a.PostLikeWire({template:"main_page.post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.categories.other}),a.makeTab(b)},events:function(a){var b;return b=new a.PostLikeWire({template:"main_page.event-resources",emptyMessage:"No events here yet.",collection:CommonPlace.community.events}),a.makeTab(b)},announcements:function(a){var b;return b=new a.PostLikeWire({template:"main_page.announcement-resources",emptyMessage:"No announcements here yet.",collection:CommonPlace.community.announcements}),a.makeTab(b)},transactions:function(a){var b;return b=new a.PostLikeWire({template:"main_page.transaction-resources",emptyMessage:"No items here yet.",collection:CommonPlace.community.transactions}),a.makeTab(b)},discussions:function(a){var b;return b=new a.PostLikeWire({template:"main_page.group-post-resources",emptyMessage:"No posts here yet.",collection:CommonPlace.community.groupPosts}),a.makeTab(b)},groups:function(a){var b;return b=new a.GroupLikeWire({template:"main_page.directory-resources",emptyMessage:"No groups here yet.",collection:CommonPlace.community.groups,active:"groups"}),a.makeTab(b)},feeds:function(a){var b;return b=new a.GroupLikeWire({template:"main_page.directory-resources",emptyMessage:"No feeds here yet.",collection:CommonPlace.community.feeds,active:"feeds"}),a.makeTab(b)},users:function(a){var b;return b=new a.GroupLikeWire({template:"main_page.directory-resources",emptyMessage:"No users here yet.",collection:CommonPlace.community.users,active:"users"}),a.makeTab(b)}},showPost:function(a){var b;return b=this,a.fetch({success:function(){return b.showSingleItem(a,Posts,{template:"main_page.post-resources",tab:"posts"})}})},showFeedPage:function(a){return $.getJSON("/api/feeds/"+a,_.bind(function(a){var b,c;return b=new Feed(a),c=new this.PostLikeWire({template:"main_page.announcement-resources",card:"feed",emptyMessage:"No announcements here yet.",collection:b.announcements}),c.searchPage(b),this.changeSearchText(b.get("name")),this.view=this.makeTab(c),this.showTab()},this))},showFeedSubscribers:function(a){return $.getJSON("/api/feeds/"+a,_.bind(function(a){var b,c;return b=new Feed(a),c=new this.PostLikeWire({template:"main_page.user-wire-resources",card:"feed",emptyMessage:"No announcements here yet.",collection:b.subscribers}),c.searchPage(b),this.changeSearchText(b.get("name")),this.view=this.makeTab(c),this.showTab()},this))},showGroupPage:function(a){return $.getJSON("/api/groups/"+a,_.bind(function(a){var b,c;return b=new Group(a),c=new this.PostLikeWire({template:"main_page.announcement-resources",card:"group",emptyMessage:"No announcements here yet.",collection:b.posts}),c.searchPage(b),this.changeSearchText(b.get("name")),this.view=this.makeTab(c),this.showTab()},this))},showAnnouncement:function(a){var b;return b=this,a.fetch({success:function(){return b.showSingleItem(a,Announcements,{template:"main_page.announcement-resources",tab:"announcements"})}})},showEvent:function(a){var b;return b=this,a.fetch({success:function(){return b.showSingleItem(a,Events,{template:"main_page.event-resources",tab:"events"})}})},showTransaction:function(a){var b;return b=this,a.fetch({success:function(){return b.showSingleItem(a,Transactions,{template:"main_page.transaction-resources",tab:"transactions"})}})},showGroupPost:function(a){var b;return b=this,a.fetch({success:function(){return b.showSingleItem(a,GroupPosts,{template:"main_page.group-post-resources",tab:"discussions"})}})},highlightSingleUser:function(a){return this.singleUser=a},showSingleItem:function(a,b,c){var d,e;return this.model=a,this.isSingle=!0,d=this,e=new LandingPreview({template:c.template,collection:new b([a],{uri:a.link("self")})}),_.isEmpty(this.singleUser)||(e.searchUser(this.singleUser),this.singleUser={}),this.switchTab(c.tab,e),$(window).scrollTo(0)},showUserWire:function(a){var b;return b=this,a.fetch({success:function(){var c,d;return c=new PostLikes([],{uri:a.link("postlikes")}),d=new Wire({template:"main_page.user-wire-resources",card:"user",collection:c,emptyMessage:"No posts here yet."}),d.searchUser(a),b.switchTab("posts",d),$(window).scrollTo(0)}})},debounceSearch:_.debounce(function(){return this.search()},CommonPlace.autoActionTimeout),search:function(a){return this.currentQuery=this.eventAggregator.query,this.currentQuery?(this.view.search(this.currentQuery),this.showTab()):this.cancelSearch()},cancelSearch:function(a){return this.currentQuery="",this.$(".sticky form.search input").val(""),this.view&&this.view.cancelSearch(),this.showTab(),$(".sticky form.search input").removeClass("active"),$(".sticky .cancel").hide(),$(".resources").removeHighlight()},makeTab:function(a){return new this.ResourceTab({wire:a})},loading:function(){var a;return a=new this.LoadingResource,a.render(),a.el},PostLikeWire:Wire.extend({_defaultPerPage:15}),GroupLikeWire:Wire.extend({_defaultPerPage:50}),ResourceTab:CommonPlace.View.extend({initialize:function(a){return this.wire=a.wire},resources:function(a){return this.single?a(this.single):a(this.wire)},search:function(a){return this.single&&(this.single=null),this.wire.search(a)},singleWire:function(a){return this.single=a},cancelSearch:function(){return this.search("")}}),SearchForm:CommonPlace.View.extend({template:"main_page.community-search-form",tagName:"form",className:"search"}),LoadingResource:CommonPlace.View.extend({template:"main_page.loading-resource",className:"loading-resource"})})})).call(this);var DynamicLandingResources=CommonPlace.View.extend({template:"main_page.dynamic-landing-resources",className:"resources",initialize:function(a){this.raw=new CommunityWire({uri:CommonPlace.community.link("landing_wires")}),this.postlikes=new PostLikes([],{uri:CommonPlace.community.link("post_likes")}),this._wires=[],this.single={},this.callback=a.callback},resources:function(a){var b=this;!_.isEmpty(this.single)&&!this.currentQuery?a(this.single):_.isEmpty(this._wires)?this.currentQuery?this.postlikes.fetch({data:{query:this.currentQuery},success:function(){b.makeSearch(),b.resources(a)}}):this.raw.fetch({},function(){b.makeWires(),b.resources(a)}):_.each(this._wires,function(b){a(b)})},makeWires:function(){var a=this,b=[new LandingPreview({template:"main_page.post-neighborhood-resources",collection:a.raw.neighborhood,emptyMessage:"No posts here yet.",callback:a.callback}),new LandingPreview({template:"main_page.post-offer-resources",collection:a.raw.offers,emptyMessage:"No offers here yet.",callback:a.callback}),new LandingPreview({template:"main_page.post-help-resources",collection:a.raw.help,emptyMessage:"No help requests here yet.",callback:a.callback}),new LandingPreview({template:"main_page.post-publicity-resources",collection:a.raw.publicity,emptyMessage:"No posts here yet.",callback:a.callback}),new LandingPreview({template:"main_page.post-other-resources",collection:a.raw.other,emptyMessage:"No posts here yet.",callback:a.callback}),new LandingPreview({template:"main_page.group-post-resources",collection:a.raw.groupPosts,emptyMessage:"No posts here yet.",callback:a.callback}),new LandingPreview({template:"main_page.post-meetup-resources",collection:a.raw.meetups,emptyMessage:"No meetups here yet.",callback:a.callback})],c=[],d=_.filter(b,function(a){return a.collection.length>0}),e=_.filter(b,function(a){return!a.collection.length});d=_.sortBy(d,function(a){return parseDate(a.collection.first().get("published_at"))}),d.reverse();var f=d.shift(),g=new LandingPreview({template:"main_page.event-resources",collection:a.raw.events,emptyMessage:"No events here yet.",callback:a.callback}),h=new LandingPreview({template:"main_page.transaction-resources",collection:a.raw.transactions,emptyMessage:"No items here yet.",callback:a.callback}),i=new Wire({template:"main_page.chrono-resources",collection:CommonPlace.community.postlikes,emptyMessage:"No posts here yet.",perPage:22,callback:a.callback});_.each(a.raw.all(),function(a){c.push(a.models)}),i.collection.setDupes(_.flatten(c)),a._wires=[f],a._wires.push(d),h.collection.length&&a._wires.push(h),g.collection.length&&a._wires.push(g),a._wires.push(i),a._wires=_.flatten(a._wires)},makeSearch:function(){var a=new Wire({template:"main_page.chrono-search-resources",collection:this.postlikes,emptyMessage:"No results.",perPage:22,callback:this.callback});a.search(this.currentQuery),this._wires=[a]},search:function(a){this.currentQuery=a,this._wires=[],this.single={}},cancelSearch:function(){this.search("")},singleWire:function(a){this.single=a}}),LandingPreview=PreviewWire.extend({template:"wires.preview-wire",_defaultPerPage:3,aroundRender:function(a){a()},showMore:function(){},areMore:function(){return!1},isRecent:function(){return!0}}),FailedSearch=CommonPlace.View.extend({template:"main_page.failed-search",className:"failed-search profile",query:function(){return this.model.get("query")}}),FeedProfile=CommonPlace.View.extend({template:"main_page.feed-profile",className:"profile",events:{"click .message":"showMessageForm","click .subscribe":"subscribe","click .unsubscribe":"unsubscribe","click .edit-feed":"showFeedEditForm"},avatarUrl:function(){return this.model.get("avatar_url")},fullName:function(){return this.model.get("name")},shortName:function(){return this.model.get("first_name")},about:function(){return this.model.get("about")},groups:function(){return""},showMessageForm:function(a){a.preventDefault();var b=new MessageFormView({model:new Message({messagable:this.model})});b.render()},showFeedEditForm:function(a){a.preventDefault();var b=new FeedEditFormView({model:this.model});b.render()},subscribe:function(a){a.preventDefault(),CommonPlace.account.subscribeToFeed(this.model,_.bind(function(){this.render()},this))},unsubscribe:function(a){a.preventDefault(),CommonPlace.account.unsubscribeFromFeed(this.model,_.bind(function(){this.render()},this))},isSubscribed:function(){return CommonPlace.account.isSubscribedToFeed(this.model)},isOwner:function(){return CommonPlace.account.isFeedOwner(this.model)},url:function(){return this.model.get("url")}});((function(){CommonPlace.main.AnnouncementForm=CommonPlace.main.BaseForm.extend({template:"main_page.forms.announcement-form",className:"create-announcement post",initialize:function(a){var b,c,d,e,f;CommonPlace.main.BaseForm.prototype.initialize(a),this.feeds=CommonPlace.account.get("feeds"),this.hasFeeds=!1,this.feeds.length>0&&(this.hasFeeds=!0),this.hasBusinessFeeds=!1,e=this.feeds,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b.kind===2?f.push(this.hasBusinessFeeds=!0):f.push(void 0);return f},createPost:function(a){var b,c,d;return a.preventDefault(),this.cleanUpPlaceholders(),this.showSpinner(),this.disableSubmitButton(),this.$("error").hide(),d=this.$("[name=feed_selector]").val(),d!==void 0&&d!==""?(c=new Feed({links:{self:"/feeds/"+d,announcements:"/feeds/"+d+"/announcements"}}),b={title:this.$("[name=title]").val(),body:this.$("[name=body]").val()},this.sendPost(c.announcements,b,this.announcementSuccess)):(this.showError("Please select an organization to promote"),this.hideSpinner(),this.enableSubmitButton())},name:function(){return this.feed.get("name")},announcementSuccess:function(){return CommonPlace.community.announcements.trigger("sync")}})})).call(this),function(){CommonPlace.main.EventForm=CommonPlace.main.BaseForm.extend({template:"main_page.forms.event-form",className:"create-event event",initialize:function(a){CommonPlace.main.BaseForm.prototype.initialize(a),this.feeds=CommonPlace.account.get("feeds"),this.user=CommonPlace.account.get("name"),this.hasFeeds=!1;if(this.feeds.length>0)return this.hasFeeds=!0},afterRender:function(){var a;return this.$("input.date",this.el).datepicker({dateFormat:"yy-mm-dd"}),this.$("input[placeholder], textarea[placeholder]").placeholder(),this.hideSpinner(),this.$("select.time").dropkick(),a=this,this.$("input.date").bind("change",function(){return a.onFormBlur({target:a.$("input.date")})}),this.populateFormData()},createPost:function(a){var b,c,d,e;a.preventDefault(),this.showSpinner(),this.disableSubmitButton(),e=this,this.cleanUpPlaceholders(),b={title:this.$("[name=title]").val(),body:this.$("[name=body]").val(),date:this.$("[name=date]").val(),starts_at:this.$("[name=start]").val(),ends_at:this.$("[name=end]").val(),venue:this.$("[name=venue]").val(),address:this.$("[name=address]").val(),groups:this.$("[name=groups]:checked").map(function(){return $(this).val()}).toArray()},d=this.$("[name=feed_selector]").val();if(d===""){this.showError("Please choose who to post as"),this.hideSpinner(),this.enableSubmitButton();return}return d!==void 0&&d!=="self"?(c=new Feed({links:{self:"/feeds/"+d,events:"/feeds/"+d+"/events"}}),this.sendPost(c.events,b,this.eventSuccess)):this.sendPost(CommonPlace.community.events,b)},eventSuccess:function(){return CommonPlace.community.events.trigger("sync")},groups:function(){return CommonPlace.community.get("groups")},time_values:_.flatten(_.map(["am","pm"],function(a){return _.map([12,1,2,3,4,5,6,7,8,9,10,11],function(b){return _.map(["00","30"],function(c){return String(b)+":"+c+a})})}))})}.call(this),function(){CommonPlace.main.PostForm=CommonPlace.main.BaseForm.extend({template:"main_page.forms.post-form",className:"create-neighborhood-post post",initialize:function(a){return CommonPlace.main.BaseForm.prototype.initialize(a),this.groups=CommonPlace.community.get("groups")},createPost:function(a){var b,c,d,e,f;return a.preventDefault(),this.cleanUpPlaceholders(),this.showSpinner(),this.disableSubmitButton(),c=CommonPlace.community.posts,b=!1,f=this.$("[name=group_selector]").val(),f!==void 0&&f!==""&&(e=new Group({links:{self:"/groups/"+f,posts:"/groups/"+f+"/posts"}}),c=e.posts,b=this.groupPostSuccess),d={title:this.$("[name=title]").val(),body:this.$("[name=body]").val()},this.category!==void 0&&(d.category=this.category),this.sendPost(c,d,b)},groupPostSuccess:function(){return CommonPlace.community.groupPosts.trigger("sync")}})}.call(this),function(){CommonPlace.main.TransactionForm=CommonPlace.main.BaseForm.extend({template:"main_page.forms.transaction-form",className:"create-transaction transaction",initialize:function(a){CommonPlace.main.BaseForm.prototype.initialize(a),this.feeds=CommonPlace.account.get("feeds"),this.user=CommonPlace.account.get("name"),this.hasFeeds=!1;if(this.feeds.length>0)return this.hasFeeds=!0},afterRender:function(){var a;return this.data={},this.data.image_id=[],this.$("input[placeholder], textarea[placeholder]").placeholder(),this.isPostEdit()?this.$(".item_pic").hide():(this.initImageUploader(this.$(".one"),1),this.initImageUploader(this.$(".two"),2),this.initImageUploader(this.$(".three"),3)),this.hideSpinner(),a=this,this.populateFormData()},initImageUploader:function(a,b){var c;return c=this,this.imageUploader=new AjaxUpload(a,{action:"/api/transactions/image",name:"image",data:this.data,responseType:"text/html",autoSubmit:!0,onChange:function(){return c.hasImageFile=!0},onSubmit:_.bind(function(a,c){var d;return d=$(".item_pic#"+b),d.attr("src","/assets/loading.gif"),d.parent().addClass("loading")},this),onComplete:_.bind(function(a,c){var d;return c=$.parseJSON(c),d=$(".item_pic#"+b),d.attr("src",c.image_normal),d.parent().removeClass("loading"),this.data.image_id[b-1]=c.id},this)})},createPost:function(a){var b,c,d,e;a.preventDefault(),this.cleanUpPlaceholders(),this.showSpinner(),this.disableSubmitButton(),d=this.$("[name=price]").val(),d.length>0&&(e=Number(d.replace(/[^0-9\.]+/g,"")*100).toFixed(2)),this.data.title=this.$("[name=title]").val(),this.data.price=e,this.data.body=this.$("[name=body]").val(),c=this.$("[name=feed_selector]").val();if(c===""){this.showError("Please choose who to post as"),this.hideSpinner(),this.enableSubmitButton();return}return c!==void 0&&c!=="self"?(b=new Feed({links:{self:"/feeds/"+c,transactions:"/feeds/"+c+"/transactions"}}),this.sendPost(b.transactions,this.data)):this.sendPost(CommonPlace.community.transactions,this.data)},sendPost:function(a,b){var c,d,e;d=this;if(this.isPostEdit()){for(c in b)e=b[c],this.model.set(c,e);return this.model.save(),this.exit()}return a.create(b,{success:_.bind(function(a){d.hasImageFile&&d.addImageToPost(a),d.render(),CommonPlace.community.transactions.trigger("sync"),this.showShareModal(a,"Thanks for posting!","You've just shared this post with "+this.getUserCount()+" neighbors in "+this.community_name()+". Share with some more people!");if(typeof _kmq!="undefined"&&_kmq!==null)return _kmq.push(["record","Post",{Schema:a.get("schema"),ID:a.id}])},this),error:function(a,b){return typeof _kmq!="undefined"&&_kmq!==null&&_kmq.push(["record","Post Error",{Attributes:a}]),d.enableSubmitButton(),d.showError(b.responseText)}})},addImageToPost:function(a){return $.ajax({type:"POST",url:"/api"+a.get("links").self+"/add_image",data:{image_id:a.get("image_id")},success:function(a){},dataType:"JSON"})}})}.call(this);var GroupProfile=CommonPlace.View.extend({template:"main_page.group-profile",className:"profile",events:{"click .subscribe":"subscribe","click .unsubscribe":"unsubscribe"},avatarUrl:function(){return this.model.get("avatar_url")},fullName:function(){return this.model.get("name")},about:function(){return this.model.get("about")},subscribe:function(a){a.preventDefault(),CommonPlace.account.subscribeToGroup(this.model,_.bind(function(){this.render()},this))},unsubscribe:function(a){a.preventDefault(),CommonPlace.account.unsubscribeFromGroup(this.model,_.bind(function(){this.render()},this))},isSubscribed:function(){return CommonPlace.account.isSubscribedToGroup(this.model)},url:function(){return this.model.get("url")}}),FixedLayout=function(){function a(){if($("#community-resources").offset()){var a=$("#community-resources").offset().left;$("#community-resources .navigation").css({left:a}),$("#community-resources .sticky").css({left:a}),$("#community-resources-spacer").css({left:a})}}this.reset=function(){a()},this.bind=function(){$(window).bind("scroll.communityLayout",this.reset).bind("resize.communityLayout",this.reset)},this.unbind=function(){$(window).unbind(".communityLayout")}},StaticLayout=function(){function a(){var a=$("#profile-box");a.css({width:a.width()}),a.css("position")=="fixed"&&a.css({top:0,bottom:"auto"});var b=parseInt(a.css("margin-top"),10),c=a.parent(),d=$("#footer").offset().top,e=$(window).scrollTop(),f=a.offset().top,g=c.offset().top+c.height();if(a.css("position")=="relative")f<e&&a.css({position:"fixed",top:0,bottom:"auto"});else if(f<g+b)a.css({position:"relative"});else if(f+a.height()>d){var h=e+$(window).height()+20-d;a.css({top:"auto",bottom:h})}}this.bind=function(){$(window).bind("scroll.communityLayout",a)},this.unbind=function(){$(window).unbind(".communityLayout")},this.reset=$.noop};((function(){CommonPlace.main.PostBox=FormView.extend({template:"main_page.post-box",events:{"click .navigation li":"clickTab","click .close":"exit"},afterRender:function(){return this.$(".post-box").addClass("first"),this.modal.render()},clickTab:function(a){return a.preventDefault(),this.switchTab($(a.currentTarget).attr("data-tab"),a)},switchTab:function(a,b){return this.showTab(a)},showTab:function(a,b){var c;return c=void 0,c=this.tabs(a,b),c.render(),this.$(".post-box").removeClass("first"),this.$(".links").html(c.el),this.$("[placeholder]").placeholder(),this.browserSupportsPlaceholders()&&$.browser.webkit&&this.$("input:visible:first").focus(),CommonPlace.layout.reset(),c.onFormFocus&&c.onFormFocus(),this.browserSupportsPlaceholders()&&($(".chzn-select").chosen(),$(".chzn-drop").css("width","413px")),this.modal.centerEl()},tabs:function(a,b){var c,d,e;return d=this,e=void 0,c={nothing:function(){return new CommonPlace.main.PostForm({model:b,modal:d.modal})},event:function(){return new CommonPlace.main.EventForm({model:b,modal:d.modal})},promote:function(){return new CommonPlace.main.AnnouncementForm({model:b,modal:d.modal})},transaction:function(){return new CommonPlace.main.TransactionForm({model:b,modal:d.modal})},discussion:function(){return new CommonPlace.main.PostForm({category:"neighborhood",template:"main_page.forms.post-form",model:b,modal:d.modal})},request:function(){return new CommonPlace.main.PostForm({category:"offers",template:"main_page.forms.question-form",model:b,modal:d.modal})}},c[a]?e=c[a]():e=new CommonPlace.main.AnnouncementForm,e},groups:function(){return CommonPlace.community.get("groups")},feeds:function(){return CommonPlace.account.get("feeds")},promote_header:function(){var a;return this.isHarvardNeighbors()?"Post an Announcement":(a=this.feeds(),a.length===1?"Promote "+a[0].name:"Promote Your Work")}})})).call(this);var ProfileHistory=CommonPlace.View.extend({template:"main_page.profile-history",history:function(){var a=this;return _.map(this.collection,function(b){return new ProfileHistoryItem({model:b,name:a.shortName()})})},shortName:function(){return this.model.get("first_name")||this.model.get("short_name")},hasHistory:function(){return _.size(this.collection)!==0}});ProfileHistoryItem=CommonPlace.View.extend({to_html:function(){var a="main_page.history_items."+this.model.schema;return this.renderTemplate(a,_.extend({},this.model,{name:this.options.name,slug:CommonPlace.community.get("slug")}))}}),function(){CommonPlace.main.TourModal=CommonPlace.View.extend({id:"main",tagName:"div",overlayLevel:1e3,changedElements:[],events:{"click .close":"end","click #profile-box, #community-resources, #post-box":"end"},initialize:function(a){this.firstSlide=!0;if(a.exitWhenDone)return this.exitWhenDone=!0},render:function(){return this.$("#tour").html(this.renderTemplate("main_page.tour.wire",this)).attr("class","wire"),$(this.el).append("<div id='tour-shadow'></div>"),$(this.el).append(this.renderTemplate("main_page.tour.modal",this)),$("body").css({overflow:"hidden"}),$("#current-registration-page").css({overflow:"auto"})},showPage:function(a,b){var c,d,e,f;return e=this,d=function(a,b){return e.showPage(a,b)},c=function(a,b){return e.fadeIn(a,b)},this.firstSlide||this.fadeOut(),f={email:function(){return new CommonPlace.main.EmailView({nextPage:d,data:b,fadeIn:c,community:e.community,account:e.account})},address:function(){return new CommonPlace.main.AddressView({nextPage:d,data:b,fadeIn:c,community:e.community,account:e.account})},welcome:function(){return new CommonPlace.main.WelcomeView({nextPage:d,data:b,fadeIn:c,community:e.community,account:e.account})},profile:function(){return new CommonPlace.main.ProfileView({nextPage:d,data:b,fadeIn:c,community:e.community,account:e.account})},create_page:function(){return new CommonPlace.main.CreatePageView({nextPage:d,data:b,fadeIn:c,community:e.community,account:e.account,exitWhenDone:e.exitWhenDone})},subscribe:function(){return new CommonPlace.main.SubscribeView({nextPage:d,fadeIn:c,community:e.community,account:e.account,data:b,complete:e.options.complete})},rules:function(){return new CommonPlace.main.RulesView({nextPage:d,fadeIn:c,community:e.community,account:e.account,data:b,complete:e.options.complete})},neighbors:function(){return new CommonPlace.main.NeighborsView({complete:e.options.complete,fadeIn:c,community:e.community,account:e.account,data:b,nextPage:d})}}[a](),typeof _kmq!="undefined"&&_kmq!==null&&
_kmq.push(["record","Tour: "+a+" page"],{community:CommonPlace.community.get("name")}),f.render()},welcome:function(){return this.showPage("welcome")},end:function(){return $("#tour-shadow").remove(),$("#tour").remove(),$("body").css({overflow:"auto"})},centerEl:function(a){var b,c,d;a.css(this.dimensions(a)),d=$(window).height(),b=a.height(),c=a.offset().top;if(c+b>d)return a.css({overflow:"auto"}),a.height(d-c)},fadeOut:function(){var a;return a=this.$("#current-tour-page"),a.css("filter","alpha(opacity=40)"),a.fadeOut("slow",function(){return a.empty(),a.hide()})},fadeIn:function(a,b){var c,d,e;return d=this.$("#next-tour-page"),c=this.$("#current-tour-page"),e=this.$("#tour"),d.append(a),d.css("filter","alpha(opacity=40)"),this.centerEl(d),d.fadeIn("slow",_.bind(function(){c.html(d.children("div").detach()),this.centerEl(c),c.show(),d.empty(),d.hide();if(b)return b()},this))},dimensions:function(a){var b;return b=($(window).width()-a.width())/2,{left:b}}}),CommonPlace.main.TourModalPage=CommonPlace.View.extend({initialize:function(a){return this.data=a.data||{},this.fadeIn=a.fadeIn,this.nextPage=a.nextPage,this.complete=a.complete,this.exitWhenDone=a.exitWhenDone},showError:function(a,b,c){return a.addClass("input_error"),b.text(c),b.show()},end:function(){return $("#tour-shadow").remove(),$("#tour").remove(),$("body").css({overflow:"auto"})},first_name:function(){return CommonPlace.account.get("short_name")},avatar_url:function(){return CommonPlace.account.get("avatar_url")},showSpinner:function(){return this.$(".spinner").show()},hideSpinner:function(){return this.$(".spinner").hide()},validate_registration:function(a,b){var c;return c="/api"+CommonPlace.community.get("links").registration.validate,$.getJSON(c,this.data,_.bind(function(c){var d;this.$(".error").hide();if(c.id)return CommonPlace.account=new Account(c),window.location=window.location.protocol+"//"+window.location.host+"/"+CommonPlace.community.get("slug");d=!0;if(!_.isEmpty(c.facebook))return window.location.pathname=CommonPlace.community.links.facebook_login;_.each(a,_.bind(function(a){var b,e,f;if(!_.isEmpty(c[a]))return b=this.$(".error."+a),f=this.$("input[name="+a+"]"),e=_.reduce(c[a],function(a,b){return a+" and "+b}),f.addClass("input_error"),b.text(e),b.show(),d=!1},this)),d||this.hideSpinner();if(d&&b)return b()},this))}})}.call(this),function(){CommonPlace.main.AddressView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.address",events:{"click input.continue":"submit","submit form":"submit","click .next-button":"submit","click .confirm":"verified"},afterRender:function(){var a;return this.hideSpinner(),this.initReferralQuestions(),this.$("input[placeholder]").placeholder(),this.fadeIn(this.el),a="/api/communities/"+CommonPlace.community.id+"/address_completions",this.$("input[name=address]").autocomplete({source:a,minLength:1,autoFocus:!0})},submit:function(a){var b;a&&a.preventDefault(),this.$(".error").hide(),this.data.address=this.$("input[name=address]").val(),this.data.referral_source=this.$("select[name=referral_source]").val(),this.data.referral_metadata=this.$("input[name=referral_metadata]").val();if(this.data.address.length<1){this.showError(this.$("input[name=address]"),this.$(".error.address"),"Please enter a valid address");return}if(this.data.referral_source==="placeholder"){this.showError(this.$("select[name=referral_source]"),this.$(".error.referral_source"),"Please tell us how you heard about OurCommonPlace");return}if(!this.$("#referral_metadata").is(":hidden")&&!this.data.referral_metadata){this.showError(this.$("select[name=referral_metadata]"),this.$(".error.referral_metadata"),"Please fill out the field above. It'll give us a chance to thank who brought you aboard!");return}return this.$("#address_verification").is(":hidden")?(this.data.term=this.data.address,this.showSpinner(),b="/api/communities/"+CommonPlace.community.id+"/address_approximate",$.get(b,this.data,_.bind(function(a){var b,c,d,e,f;c=this.$("#address_verification"),d=this.$("input.address_verify_radio"),e=this.$("span.address_verify_radio"),b=this.$("#suggested_address"),f=parseFloat(a[0]);if(f===-1)return this.verified();if(a[1].length<1||f<.84)this.showError(this.$("input[name=address]"),this.$(".error.address"),"Please enter a valid address"),this.$("#bypass").show(),this.hideSpinner();else{if(!(f<.94))return this.data.address=a[1],this.verified();this.data.suggest=a[1],b.empty(),b.text(a[1]),c.show(),d.show(),e.show(),b.show(),this.hideSpinner()}},this))):(this.$("#suggested").is(":checked")&&(this.data.address=this.data.suggest),this.verified())},verified:function(){var a;return a="/api"+CommonPlace.community.get("links").registration[this.data.isFacebook?"facebook":"new"],$.post(a,this.data,_.bind(function(a){if(a.success==="true"||a.id)return CommonPlace.account=new Account(a),delete this.data.term,delete this.data.suggest,this.nextPage("profile",this.data);if(!_.isEmpty(a.facebook))return window.location.pathname=CommonPlace.community.links.facebook_login;if(!_.isEmpty(a.password))return this.$(".error").text(a.password[0]),this.$(".error").show(),this.hideSpinner()},this))},referrers:function(){return CommonPlace.community.get("referral_sources")},initReferralQuestions:function(){return this.$("#referral_metadata").hide(),this.$("select.dk").dropkick({change:_.bind(function(a,b){var c,d;return d={"Heard about it from a friend or neighbor":"From who? We'd love to thank them!","Heard about it in a news story":"Which news source? We'd love to thank them!",Other:"What made you join? It'll help our effort to let us know!"},c=d[a],c?(this.$("input[name=referral_metadata]").attr("placeholder",c),this.$("#referral_metadata").show()):this.$("#referral_metadata").hide()},this)})}})}.call(this),function(){CommonPlace.main.CreatePageView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.create_page",events:{"click input.continue":"submit","submit form":"submit","click .next-button":"submit","click .cancel-button":"cancel"},initialize:function(a){return CommonPlace.main.TourModalPage.prototype.initialize(a),this.data&&this.data.isModel?this.model=this.data:(this.new_feed=!0,this.createFeed({name:CommonPlace.account.get("name")+"'s new page"}))},afterRender:function(){var a;this.hideSpinner(),this.hasAvatarFile=!1,this.$("input[placeholder], textarea[placeholder]").placeholder(),this.model&&(this.initAvatarUploader(this.$(".avatar_file_browse")),a=this.model.get("kind"),this.$("[name=page_kind] [value="+a+"]").attr("selected","selected")),this.$("select.dk").dropkick();if(!this.current)return this.fadeIn(this.el),this.current=!0},createFeed:function(a){return $.ajax({type:"post",url:"/api"+CommonPlace.community.feeds.uri,data:JSON.stringify(a),dataType:"json",success:_.bind(function(a){return this.model=new Feed(a),this.initAvatarUploader(this.$(".avatar_file_browse"))},this),error:_.bind(function(a,b){var c;return c=this.$(".error"),c.html("Error creating feed"),c.show()},this)})},submit:function(a){var b,c,d;return d=this,a&&a.preventDefault(),this.$(".error").hide(),c=this.$("input[name=name]").val(),this.isHarvardNeighbors()?b=1:b=this.$("select[name=page_kind]").val(),c===""?this.showError(this.$("input[name=name]"),this.$(".error.name"),"Please enter a page name"):b===""?this.showError(this.$("select[name=page_kind]"),this.$(".error.kind"),"Please select what type of organization you are creating"):(this.showSpinner(),this.model.save({name:c,about:this.$("textarea[name=about]").val(),address:this.$("input[name=address]").val(),website:this.$("input[name=website]").val(),phone:this.$("input[name=phone]").val(),tags:this.$("input[name=tags]").val(),kind:b,rss:this.$("input[name=rss]").val()},{success:function(){return d.next_step()}}))},cancel:function(a){return a&&a.preventDefault(),this.new_feed&&this.model.destroy(),this.next_step()},next_step:function(){return this.options.exitWhenDone?(app.showFeedPage(CommonPlace.community.get("slug"),this.model.id),$(".account-sub li").eq(2).after("<li><a class='feed-link' href='/pages/"+this.model.get("slug")+"'>"+this.model.get("name")+"</a></li>"),this.end()):this.nextPage("subscribe",this.data)},initAvatarUploader:function(a){var b;return b=this,this.avatarUploader=new AjaxUpload(a,{name:"avatar",action:"/api"+this.avatarEditUrl(),data:{},responseType:"json",autoSubmit:!0,onChange:function(a,c){return b.toggleAvatar()},onSubmit:function(a,b){},onComplete:function(a,c){return b.model.set(c),b.$(".profile_pic").attr("src",b.avatarUrl())}})},toggleAvatar:function(){return this.hasAvatarFile=!0,this.$("a.avatar_file_browse").html("Photo Added! ✓")},pageName:function(){return this.model?this.model.get("name"):""},about:function(){return this.model?this.model.get("about"):""},address:function(){return this.model?this.model.get("address"):""},rss:function(){return this.model?this.model.get("rss"):""},website:function(){return this.model?this.model.get("website"):""},phone:function(){return this.model?this.model.get("phone"):""},slug:function(){return this.model?this.model.get("slug"):""},deleteUrl:function(){return this.model?this.model.get("delete_url"):""},avatarUrl:function(){return this.model?this.model.link("avatar").thumb:"/avatars/missing.png"},editUrl:function(){return this.model?this.model.link("edit"):""},avatarEditUrl:function(){return this.model?this.model.link("avatar_edit"):""}})}.call(this),function(){CommonPlace.main.EmailView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.email",events:{"click input.continue":"submit","submit form":"submit","click img.facebook":"facebook","click .next-button":"submit"},afterRender:function(){var a;return this.hideSpinner(),this.$("input[placeholder]").placeholder(),this.browserSupportsPlaceholders()&&$.browser.webkit&&this.$("input:visible:first").focus(),this.fadeIn(this.el),this.data&&this.data.isFacebook&&(this.$("input[name=full_name]").val(this.data.full_name),this.isRealEmail()&&this.$("input[name=email]").val(this.data.email)),a=["hotmail.com","gmail.com","aol.com","yahoo.com"],this.$("input#email").blur(function(){return $("input#email").mailcheck(a,{suggested:function(a,b){return $(".error.email").html("Did you mean "+b.full+"?"),$(".error.email").show(),$(".error.email").click(function(c){return $(a).val(b.full)})},empty:function(a){return $(".error.email").hide()}})})},isRealEmail:function(){return!this.data||!this.data.email?!1:this.data.email.search("proxymail")===-1},facebook:function(a){return a&&a.preventDefault(),facebook_connect_registration({success:_.bind(function(a){return this.data=a,this.data.isFacebook=!0,this.nextPage("profile",this.data)},this)})},submit:function(a){var b;return a&&a.preventDefault(),this.$("input").removeClass("input_error"),this.$(".error").hide(),this.data.full_name=this.$("input[name=full_name]").val(),this.data.email=this.$("input[name=email]").val(),this.data.password=this.$("input[name=password][type=password]").val(),this.data.password===""?this.showError(this.$("input[name=password]"),this.$(".error.password"),"Password can't be empty"):(this.showSpinner(),b=["full_name","email"],this.validate_registration(b,_.bind(function(){return this.nextPage("address",this.data)},this)))}})}.call(this),function(){CommonPlace.main.NeighborsView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.neighbors",events:{"click .next-button":"submit"},afterRender:function(){return this.fadeIn(this.el),this.$("input[placeholder], textarea[placeholder]").placeholder()},submit:function(a){return a&&a.preventDefault(),this.finish()},finish:function(){return window.location.pathname="/"+CommonPlace.community.get("slug")}})}.call(this),function(){CommonPlace.main.ProfileView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.profile",upcoming_page:"subscribe",events:{"click input.continue":"submit","submit form":"submit","click img.facebook":"facebook","click .next-button":"submit"},afterRender:function(){return this.hideSpinner(),this.hasAvatarFile=!1,this.$("input[placeholder], textarea[placeholder]").placeholder(),CommonPlace.account.get("facebook_user")||this.initAvatarUploader(this.$(".avatar_file_browse")),this.form_name().val(CommonPlace.account.get("name")),this.form_about().val(CommonPlace.account.get("about")),this.form_orgs().val(CommonPlace.account.get("organizations")),this.avatar_url()&&this.$(".profile_pic").attr("src",this.avatar_url()),this.current||(this.fadeIn(this.el),this.current=!0),this.$("select.list").chosen().change({},function(){var a;return a=$(this).parent("li").children("div").children("ul"),a.click()})},submit:function(a){var b,c;return c=this,a&&a.preventDefault(),b={name:this.form_name().val(),about:this.form_about().val(),organizations:this.form_orgs().val()},this.$("input:checked").attr("id")==="yes"&&(this.upcoming_page="create_page"),this.showSpinner(),CommonPlace.account.save(b,{success:function(a){return c.nextPage(c.upcoming_page,void 0)}})},initAvatarUploader:function(a){var b;return b=this,this.avatarUploader=new AjaxUpload(a,{action:"/api"+CommonPlace.community.get("links").registration.avatar,name:"avatar",data:{},responseType:"json",autoSubmit:!0,onChange:function(){return b.toggleAvatar()},onSubmit:function(a,b){},onComplete:_.bind(function(a,b){return CommonPlace.account=new Account(b),$(".profile_pic").attr("src",this.avatar_url())},this)})},form_name:function(){return this.$("input[name=name]")},form_orgs:function(){return this.$("input[name=organizations]")},form_about:function(){return this.$("textarea[name=about]")},toggleAvatar:function(){return this.hasAvatarFile=!0,this.$("a.avatar_file_browse").html("Photo Added! ✓")},facebook:function(a){a&&a.preventDefault();if(!CommonPlace.account.get("facebook_user"))return facebook_connect_avatar({success:_.bind(function(a){return CommonPlace.account.set("facebook_user",!0),CommonPlace.account=_.extend(CommonPlace.account,a),this.toggleAvatar(),$(".profile_pic").attr("src",this.avatar_url()),CommonPlace.account.save()},this)})}})}.call(this),function(){CommonPlace.main.RulesView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.rules",events:{"click .next-button":"submit"},afterRender:function(){this.hideSpinner();if(!this.current)return this.fadeIn(this.el),this.current=!0},submit:function(a){return a&&a.preventDefault(),window.location=window.location.protocol+"//"+window.location.host+"/"+CommonPlace.community.get("slug")}})}.call(this),function(){CommonPlace.main.SubscribeView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.subscribe",feed_kinds:["communitygroup","communitygroup","business","municipal","news","communitygroup"],feed_categories:[{name:"Community Group",id:"communitygroup"},{name:"Municipal",id:"municipal"},{name:"News",id:"name"},{name:"Discussion",id:"discussion"},{name:"Business",id:"business"}],events:{"click input.continue":"submit","submit form":"submit","click .next-button":"submit"},afterRender:function(){var a,b,c;return c=this,this.hideSpinner(),this.$(".page_category").hide(),b=CommonPlace.community.groups,b.fetch({success:function(){return _.each(b.models,_.bind(function(a){var b;return b=new c.GroupItem({model:a}),b.render(),$(".discussion").append(b.el),$("#discussion").show()},this))}}),a=CommonPlace.community.feeds,a.fetch({success:function(){return _.each(a.models,_.bind(function(a){var b,d;return d=new c.FeedItem({model:a}),d.render(),b=c.feed_kinds[a.get("kind")],$("."+b).append(d.el),$("#"+b).show()},this))}}),this.fadeIn(this.el)},categories:function(){return this.isHarvardNeighbors?[{name:"Community Group",id:"communitygroup"}]:this.feed_categories},submit:function(a){var b,c;return a&&a.preventDefault(),this.showSpinner(),b=_.map(this.$("input[name=feeds_list]:checked"),function(a){return $(a).val()}),_.isEmpty(b)||CommonPlace.account.subscribeToFeed(b),c=_.map(this.$("input[name=groups_list]:checked"),function(a){return $(a).val()}),_.isEmpty(c)||CommonPlace.account.subscribeToGroup(c),this.finish()},finish:function(){return this.nextPage("rules",this.data)},FeedItem:CommonPlace.View.extend({className:"page_item",template:"main_page.tour.feed-item",events:{click:"check"},initialize:function(a){return this.model=a.model},afterRender:function(){return this.$(".avatar-container").css({"background-size":"cover"})},avatar_url:function(){return this.model.get("avatar_url")},feed_id:function(){return this.model.get("id")},feed_name:function(){return this.model.get("name")},feed_about:function(){return this.model.get("about")},check:function(a){var b;return a&&a.preventDefault(),b=this.$("input[type=checkbox]"),b.attr("checked")?(b.removeAttr("checked"),this.$(".check").removeClass("checked")):(b.attr("checked","checked"),this.$(".check").addClass("checked"))}}),GroupItem:CommonPlace.View.extend({className:"page_item",template:"main_page.tour.group-item",events:{click:"check"},initialize:function(a){return this.model=a.model},afterRender:function(){return this.$(".avatar-container").css({"background-size":"cover"})},avatar_url:function(){return this.model.get("avatar_url")},group_id:function(){return this.model.get("id")},group_name:function(){return this.model.get("name")},group_about:function(){return this.model.get("about")},check:function(a){var b;return a&&a.preventDefault(),b=this.$("input[type=checkbox]"),b.attr("checked")?(b.removeAttr("checked"),this.$(".check").removeClass("checked")):(b.attr("checked","checked"),this.$(".check").addClass("checked"))}})})}.call(this),function(){CommonPlace.main.WelcomeView=CommonPlace.main.TourModalPage.extend({template:"main_page.tour.welcome",events:{"click .next-button":"submit"},afterRender:function(){return this.fadeIn(this.el),this.hideSpinner()},submit:function(a){return a&&a.preventDefault(),this.showSpinner(),this.finish()},finish:function(){return this.nextPage("profile",this.data)}})}.call(this);var UserProfile=CommonPlace.View.extend({template:"main_page.user-profile",className:"profile",events:{"click .message":"showMessageForm","click .meet":"meet","click .unmeet":"unmeet","click ul.history a":"showHistoricalItem"},comma:function(a){return" "+a},afterRender:function(){var a=this;this.model.profileHistory(function(b){var c=new ProfileHistory({collection:b,el:a.$(".profile-history"),model:a.model});c.render()})},avatarUrl:function(){return this.model.get("avatar_url")},fullName:function(){return this.model.get("name")},shortName:function(){return this.model.get("first_name")},about:function(){return this.model.get("about")},post_count:function(){return this.model.get("post_count")},reply_count:function(){return this.model.get("reply_count")},interests:function(){return _.map(this.model.get("interests"),this.comma)},skills:function(){return _.map(this.model.get("skills"),this.comma)},goods:function(){return _.map(this.model.get("goods"),this.comma)},subscriptions:function(){return this.model.get("subscriptions")},groups:function(){return""},hasAbout:function(){return this.model.get("about")},hasInterests:function(){return this.model.get("interests").length>0},hasSkills:function(){return this.model.get("skills").length>0},hasGoods:function(){return this.model.get("goods").length>0},showMessageForm:function(a){a.preventDefault();var b=new MessageFormView({model:new Message({messagable:this.model})});b.render()},meet:function(a){a.preventDefault(),CommonPlace.account.meetUser(this.model),this.$(".just-met").show(),this.$(".meet").hide()},unmeet:function(a){a.preventDefault(),CommonPlace.account.unmeetUser(this.model,_.bind(function(){this.render()},this))},hasMet:function(){return CommonPlace.account.hasMetUser(this.model)},showHistoricalItem:function(){this.options.highlightSingleUser(this.model)}});((function(){CommonPlace.CommunityPage=CommonPlace.View.extend({template:"main_page.main-page",id:"main",track:!0,page_name:"community",initialize:function(a){var b;return b=this,this.account=CommonPlace.account,this.community=CommonPlace.community,this.lists=new CommonPlace.main.CommunityResources({account:this.account,community:this.community}),this.sidebar=new CommonPlace.shared.Sidebar({nav:new CommonPlace.shared.YourTown,directory:new CommonPlace.shared.Directory}),this.views=[this.sidebar,this.lists]},afterRender:function(){var a;return a=this,_(this.views).each(function(b){return b.render(),a.$("#"+b.id).replaceWith(b.el)}),CommonPlace.layout.reset()},bind:function(){return $("body").addClass("community"),CommonPlace.layout.bind()},unbind:function(){return $("body").removeClass("community"),CommonPlace.layout.unbind()}}),$(function(){return Features.isActive("2012Release")?($("body").addClass("fixedLayout"),CommonPlace.layout=new FixedLayout):CommonPlace.layout=new StaticLayout})})).call(this);