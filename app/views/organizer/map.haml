%script{:src => "http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAzr2EBOXUKnm_jVnk0OJI7xSosDVG8KKPE1-m51RBrvYughuyMxQ-i1QfUnH94QxWIa6N4U6MouMmBA", :type => "text/javascript"}
%script{:type => "text/javascript"}
  function initialize() {
  if (GBrowserIsCompatible()) {
  function createMarker(point, html, colorOptions) {

  var marker = new GMarker(point, colorOptions);
  GEvent.addListener(marker, "click", function() {
  marker.openInfoWindowHtml(html);
  });
  return marker;
  }
  var map = new GMap2(document.getElementById("map_canvas"));
  map.enableContinuousZoom();
  map.enableGoogleBar();
  map.enableScrollWheelZoom();
  map.enablePinchToZoom();
  control = new GLargeMapControl()
  map.addControl(control, control.getDefaultPosition())
  geocoder = new GClientGeocoder();
  = "geocoder.getLatLng('#{@center_zip_code}', function(point){ map.setCenter(point, 12); });"
  map.setCenter(new GLatLng(37.4419, -122.1419), 1);
  var greenIcon = new GIcon(G_DEFAULT_ICON)
  greenIcon.image = "http://www.google.com/intl/en_us/mapfiles/ms/micons/green-dot.png"
  greenMarkerOptions = { icon: greenIcon };

  var redIcon = new GIcon(G_DEFAULT_ICON);
  redIcon.image = "http://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png"
  redMarkerOptions = { icon: redIcon };

  var yellowIcon = new GIcon(G_DEFAULT_ICON);
  yellowIcon.image = "http://www.google.com/intl/en_us/mapfiles/ms/micons/yellow-dot.png";
  yellowMarkerOptions = { icon: yellowIcon };

  var orangeIcon = new GIcon(G_DEFAULT_ICON);
  orangeIcon.image = "http://www.google.com/intl/en_us/mapfiles/ms/micons/orange-dot.png";
  orangeMarkerOptions = { icon: orangeIcon };

  var blueIcon = new GIcon(G_DEFAULT_ICON);
  blueIcon.image = "http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png";
  blueMarkerOptions = { icon: blueIcon };

  - current_community.users.select{ |u| u.latitude.present? and u.longitude.present? }.each do |user|
    = "var point = new GLatLng('#{user.latitude}', '#{user.longitude}');"
    = "var marker = createMarker(point, '#{user.full_name.gsub('\'','')}', greenMarkerOptions);"
    map.addOverlay(marker);
  - @data_points.each do |p|
    = "console.log('Got data point with status #{p.status} at address #{p.address}');"
    - if p.status == "dropped"
      = "geocoder.getLatLng('#{p.address} #{@center_zip_code}', function(point) { map.addOverlay(new GMarker(point, yellowMarkerOptions)); });"
    - if p.status == "knocked"
      = "geocoder.getLatLng('#{p.address} #{@center_zip_code}', function(point) { map.addOverlay(new GMarker(point, orangeMarkerOptions)); });"
    - if p.status == "post_knocked_1"
      = "geocoder.getLatLng('#{p.address} #{@center_zip_code}', function(point) { map.addOverlay(new GMarker(point, blueMarkerOptions)); });"
    - if p.status == "no"
      = "geocoder.getLatLng('#{p.address} #{@center_zip_code}', function(point) { map.addOverlay(new GMarker(point, redMarkerOptions)); });"
  }
  }
  $(document).ready(initialize);
#map_canvas{:style => "width: 1024px; height: 700px"}

- form_tag "/organizer/add", :method => :post do
  = label_tag :address, "Address"
  = text_field_tag :address
  = @center_zip_code
  %br
  = label_tag :status, "Status"
  = select_tag :status, options_for_select([["Door-Dropped", 'dropped'], ['Door-Knocked', 'knocked'], ['Post-Knocked Once', 'post_knocked_1'], ['Impossibility', 'no']])
  = submit_tag "Enter"
